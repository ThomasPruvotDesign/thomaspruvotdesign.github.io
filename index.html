<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio PDF </title>
  <style>
    /* Réinitialisation globale et optimisation du rendu des polices */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* Empêche le défilement global horizontal */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    /* Fond d'écran fixe avec Boisbrule.png, centré et étendu */
    body {
      background: url('Boisbrule.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    /* Conteneur du PDF : 75vw x 100vh sur desktop, 95vw x 90vh sur mobile */
    #pdf-container {
      width: 75vw;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @media (max-width: 768px) {
      #pdf-container {
        width: 95vw;
        height: 90vh;
      }
    }
    /* Chaque page PDF (canvas) : centré horizontalement avec une marge inférieure de 19px (~5mm) */
    canvas {
      display: block;
      margin: 0 auto 19px auto;
      max-width: 100%;
      height: auto;
      /* On demande un rendu net (ces propriétés sont interprétées différemment selon le navigateur) */
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  </style>
  <!-- Inclusion de PDF.js et configuration du worker -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
  </script>
</head>
<body>
  <div id="pdf-container"></div>
  
  <script>
    const url = 'Portfolio.pdf'; // Chemin vers le PDF anglais
    const container = document.getElementById('pdf-container');

    // Pour Firefox, on fixe le devicePixelRatio à 2 pour une meilleure netteté
    const isFirefox = navigator.userAgent.toLowerCase().includes('firefox');
    function getDPR() {
      return isFirefox ? 2 : (window.devicePixelRatio || 1);
    }

    function renderPDF() {
      container.innerHTML = ''; // Vider le conteneur

      pdfjsLib.getDocument(url).promise.then(pdf => {
        let currentPage = 1;
        const totalPages = pdf.numPages;

        function renderPage() {
          if (currentPage > totalPages) return;

          pdf.getPage(currentPage).then(page => {
            // Obtenir les dimensions natives de la page (scale=1)
            const nativeViewport = page.getViewport({ scale: 1 });
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            // Calcul de l'échelle pour que la page tienne dans le conteneur
            const scaleFactor = Math.min(containerWidth / nativeViewport.width, containerHeight / nativeViewport.height);
            // Appliquer devicePixelRatio pour améliorer la résolution
            const dpr = getDPR();
            const finalScale = scaleFactor * dpr;
            const viewport = page.getViewport({ scale: finalScale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            // Définir la taille du canvas en fonction du viewport multiplié par le dpr
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            // Ajuster la taille d'affichage (CSS) pour garder le bon ratio
            canvas.style.width = `${viewport.width / dpr}px`;
            canvas.style.height = `${viewport.height / dpr}px`;
            // Appliquer la transformation pour compenser le dpr
            context.setTransform(dpr, 0, 0, dpr, 0, 0);
            context.imageSmoothingEnabled = true;
            context.imageSmoothingQuality = 'high';

            page.render({
              canvasContext: context,
              viewport: viewport
            }).promise.then(() => {
              container.appendChild(canvas);
              currentPage++;
              renderPage(); // Rendre la page suivante
            });
          });
        }
        renderPage();
      }).catch(error => {
        console.error("Erreur lors du chargement du PDF :", error);
      });
    }

    // Redéfinir le rendu lors du redimensionnement avec debounce
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(renderPDF, 200);
    });

    renderPDF();
  </script>
</body>
</html>